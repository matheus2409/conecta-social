document.addEventListener('DOMContentLoaded', () => {
  const tabelaProjetosBody = document.getElementById('tabela-projetos');

  // Função para carregar os projetos (continua a mesma)
  function carregarProjetos() {
    fetch('/api/projetos')
      .then(response => response.json())
      .then(projetos => {
        tabelaProjetosBody.innerHTML = ''; // Limpa a tabela
        if (projetos.length === 0) {
          tabelaProjetosBody.innerHTML = '<tr><td colspan="3" class="text-center">Nenhum projeto cadastrado.</td></tr>';
          return;
        }
        projetos.forEach(projeto => {
          const linhaHTML = `
            <tr id="projeto-${projeto.id}">
              <td>${projeto.nome}</td>
              <td>${projeto.categoria}</td>
              <td class="text-end">
                <button class="btn btn-sm btn-primary btn-editar" data-id="${projeto.id}">Editar</button>
                <button class="btn btn-sm btn-danger btn-deletar" data-id="${projeto.id}">Apagar</button>
              </td>
            </tr>
          `;
          tabelaProjetosBody.innerHTML += linhaHTML;
        });
      })
      .catch(error => {
        console.error('Erro:', error);
        tabelaProjetosBody.innerHTML = '<tr><td colspan="3" class="text-center text-danger">Falha ao carregar projetos.</td></tr>';
      });
  }

  // NOVO: "Ouvidor" de cliques para os botões de apagar
  tabelaProjetosBody.addEventListener('click', (event) => {
    // Verifica se o botão clicado é um botão de apagar
    if (event.target.classList.contains('btn-deletar')) {
      const botao = event.target;
      const projetoId = botao.dataset.id;
      
      // Pede confirmação ao usuário
      const confirmar = confirm('Você tem certeza que deseja apagar este projeto? Esta ação não pode ser desfeita.');

      if (confirmar) {
        // Se o usuário confirmou, chama a API para deletar
        fetch(`/api/projetos/${projetoId}`, {
          method: 'DELETE',
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Falha ao apagar o projeto.');
          }
          // Remove a linha da tabela da tela para um feedback visual imediato
          document.getElementById(`projeto-${projetoId}`).remove();
        })
        .catch(error => {
          console.error('Erro ao apagar projeto:', error);
          alert('Não foi possível apagar o projeto.');
        });
      }
    }
  });

  // Carrega os projetos ao iniciar a página
  carregarProjetos();
});